---
Date: 2024-07-20
tags:
  - git
  - devops
---
有時候，我們可能會發現最近的一次提交存在錯誤或需要修改。Git 提供了一個簡單的方法來修改最後一次的提交，這個方法稱為 `git commit --amend`。使用這個命令，你可以修改提交訊息、添加或刪除文件，甚至更改提交內容。以下是如何進行這些操作的詳細步驟。
### 修改最後一次提交訊息
#### 1. 修改提交訊息： 
如果你只想修改最近一次提交的訊息，可以使用 `--amend` 選項。這將打開你預設的文字編輯器，讓你編輯提交訊息。

```shell
git commit --amend
```

#### 2. 保存並退出編輯器
在編輯器中修改提交訊息後，保存並退出編輯器。新的提交訊息將取代原來的訊息。
### 修改最後一次提交的內容
#### 1. 添加文件到暫存區： 
如果你忘記添加某些文件，可以先將這些文件添加到暫存區。

```shell
git add filename
```
#### 2. 移除文件：
如果你想從提交中移除某些文件，可以使用 `git rm --cached` 將文件從暫存區中移除（但保留在工作目錄中）。

```shell
git rm --cached filename
```
#### 3. 使用 `--amend` 進行提交：
添加或移除文件後，使用 `--amend` 來更新提交。

```shell
git commit --amend
```

修改最后一次commit，但保留原先的commit message

```shell
git commit --amend --no-edit
```

假如我们修改了gitconfig文件，有了新的作者信息，我们希望更新最后一次提交的author，可以通过下面的命令

```shell
git commit --amend --no-edit --reset-author
```
#### 4. 編輯提交訊息： 
編輯提交訊息（如果需要），然後保存並退出編輯器。

## 示例
#### 添加忘記的文件
```shell
git add file.txt
```
#### 修改最後一次提交
```shell
git commit --amend
```

### 注意事項
1. **不要在公共分支上使用 `--amend`**： 當你已經將提交推送到遠端倉庫時，應避免使用 `--amend` 修改提交，因為這會改變提交歷史，可能導致其他開發者的混亂。在這種情況下，應使用新的提交來修正錯誤。
    
2. **強制推送修改後的提交**： 如果你確實需要在遠端倉庫修改已推送的提交，你需要使用強制推送（`git push --force` 或 `git push -f`）。但這應該非常謹慎使用，因為它會覆蓋遠端倉庫的歷史。
	```shell
	git push --force
	```

**總結來說，使用 `git commit --amend` 可以方便地修改最後一次提交的訊息和內容。這在本地開發時非常有用，但在已推送的提交上使用時需要謹慎，以避免對團隊其他成員造成影響。**