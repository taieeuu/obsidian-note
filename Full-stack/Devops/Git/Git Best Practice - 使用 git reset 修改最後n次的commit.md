---
Date: 2024-07-20
tags:
  - git
  - devops
---
`git reset` 是用於撤消提交或將 HEAD 指向另一個提交。它允許你重寫提交歷史，移動提交指針，並根據需要修改工作目錄和暫存區。這裡介紹如何使用 `git reset` 修改最後 N 次提交。
### 三種模式概述
1. **Soft 模式 (`--soft`)**： 這種模式只會移動 HEAD，不會改變工作目錄和暫存區的狀態。所有的變更將保留在暫存區中，這意味著你可以立即重新提交。
2. **Mixed 模式 (`--mixed`)**（默認模式）： 這種模式會移動 HEAD，並且重置暫存區，但不會改變工作目錄的狀態。所有的變更將保留在工作目錄中，但不在暫存區中，你需要重新添加文件到暫存區後才能重新提交。
3. **Hard 模式 (`--hard`)**： 這種模式會移動 HEAD，重置暫存區，同時還會改變工作目錄的狀態。所有的變更將被丟棄，工作目錄將與指定提交的狀態完全一致。
### 使用場景和示例
#### 1. `--soft` 模式
使用 `--soft` 模式當你想保留所有變更並準備重新提交時非常有用。

```shell
git reset --soft <Commit哈希>
```

這將移動 HEAD 到前一個提交，並將最近一次提交的變更保留在暫存區中。
#### 2. `--mixed` 模式
`--mixed` 模式是默認模式，適合用於你想保留工作目錄中的變更，但需要重新添加到暫存區。

```shell
git reset --mixed <Commit哈希>
```

這將移動 HEAD 到前一個提交，並將最近一次提交的變更保留在工作目錄中，但從暫存區中移除。
#### 3. `--hard` 模式
`--hard` 模式非常危險，因為它會丟棄所有未提交的變更，將工作目錄重置為指定提交的狀態。

```shell
git reset --hard <Commit哈希>
```

這將移動 HEAD 到前一個提交，並將工作目錄重置為該提交的狀態，丟棄所有未提交的變更。
### 注意事項
1. **謹慎使用 `--hard` 模式**： `--hard` 模式會丟棄所有未提交的變更，無法恢復。在使用前，確保你不需要這些變更。
2. **避免在公共分支上使用 `reset`**： 在公共分支上使用 `reset` 會改變提交歷史，這會給其他開發者帶來困難。`reset` 應該只在私有分支或尚未推送的提交上使用。
3. **保留歷史記錄**： 在進行 `reset` 前，確保你了解這些提交的歷史記錄，避免丟失重要的變更。
4. **強制推送修改後的提交**： 如果你已經將這些提交推送到遠端倉庫，你需要使用強制推送來更新遠端倉庫：
	```shell
	git push --force
	```
