---
Date: 
tags:
  - Unity
---
## 前言
這篇文章將會講述 Unity 中協程(Coroutine)的基本介紹，分享一些關於協程的應用方向，最後並總結簡單撰寫協程的步驟。
## 時間相關
Cotoutine 是一個跟時間有關的函式，後面會做更詳細的介紹，基本上就是更加簡單好用的計時器，我們可以自己撰寫一份倒數計時的工具，也能運用協程進行計時的方式去處理問題。
## 實用函數
在遊戲設計中，時間是一項非常重要的事情，隨之而來用時間安排程式步驟的協成就會成為相當實用的函數，我自己判斷協程的優點非常多，對於新手而言暫時還不用擔心濫用或浪費效能這件事情。


## 協程(Coroutine)的基本介紹
### 用時間來進行程式的控管
前面有提到，它是基於時間為主軸的函式，有開始協程 (StartCoroutine) 與中斷協程 (StopCoroutine) 的內容，並且有暫停 (yield return) 幾秒後執行下一段程式碼。

### 把工作安排到未來的時間
它的基本概念是把工作安排到未來進行處理，不需要每一幀都進行調用，直到需要的時候才會調用，並且能避免程式工作量太大後，會在不同幀執行的效能問題，會在精準的時刻同步工作。

### 3. IEnumerator (列舉器)
其中最核心的就式叫做 IEnumerator 的列舉器，我當初也是看到這個就覺得這個函式及相關知識相當複雜，因為它的字數很多以外，還有 yield retrun 這種我看不懂的程式碼，其實就是帶有時間的程式碼容器。
## 協程(Coroutine)的應用方面
### 動畫控制
如果設計師想要讓玩家在受到攻擊後，同步處理兩項程式，並且失去控制與獲得受傷的無敵幀，那就可以使用協程進行安排，程式設計師也能很好的安排無敵時間有幾秒，受傷特效什麼時候要播放。
### 等待時間
擁有等待時間的東西都很適合使用協程來進行安排，如果是固定時間可以使用調用(Invoke) 擷取延遲來讓敵人固定時間重生，如果是曲線或者不具備規律的生程時間，使用協程(Coroutine)是很適合的方式。
### 流程控制
如果在遊戲中會出現一系列相同流程的環節，使用協程(Coroutine)來進行遊戲設計是不錯的選擇，例如敵人 AI 的設計，就能使用協程控制巡邏，在發現敵人後中斷協程，改為追尋玩家等等。
### 簡單的程式碼步驟
接下來簡單敘述程式碼的撰寫步驟，不涉及完整的程式碼。
### 創建一個列舉器（IEnumerator)
首先，我們創建一個新的私人函式，這個函式使用列舉器(IEnumerator)作為宣告，並命名為 waitToDoSomeThing (等待來做某些事情)。

### 撰寫回傳值
因為它是一個正常的函式，因此會需要回傳值，也就是協程一定要等待幾秒鐘以後進行下一步，不過這個等待可以是零秒，撰寫方式「yield return new」後面接想要的等待形式。

常使用的函式是等待幾秒 (WaitForSecond)這個函式，也有其它的呼叫方式可以參考，不過詳細就要自己上網尋找了，可以使用的類似項目有非常多種。
### 開始協程
在想要開始協程的地方使用開始協程 (StartCoroutine)就可以啟動協程，協程執行完畢以後也不用主動輸入 StopCoroutine 來結束協程，它是自行穿插在每一幀的函式，並不是創建一個新的執行緒。